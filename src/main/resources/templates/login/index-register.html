<!DOCTYPE html>
<meta charset="utf-8"/>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
        layout:decorate="~{base/layout}">
<div layout:fragment="content">
    <!--med_tittle_section-->
    <div class="med_tittle_section">
        <div class="med_img_overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="med_tittle_cont_wrapper">
                        <div class="med_tittle_cont">
                            <ol class="breadcrumb">
                                <li><a th:href="@{/}">首页</a></li>
                                <li>注册</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- med_tittle_section End -->
    <!--service section start-->
    <div class="page-container">
        <div class="container">
            <div class="row med_toppadder50 med_bottompadder50">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 col-lg-offset-3 col-md-offset-3">
                    <form action="#" method="post" class="cy-form boxed" id="form-submit" enctype="multipart/form-data">
                        <div class="page-body">
                            <div class="content-div">
                                <br/>
                                <h4>&nbsp;新用户注册</h4>
                                <hr>
                                <div style="padding-left: 30px;">

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="username">
                                            <div class="form-group find-name">
                                                <label class="form-title control-label">
                                                    <span class="text-danger">*</span><b>用户名</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="text" maxlength="300" class="form-control"
                                                           name="username">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="password">
                                            <div class="form-group find-name">
                                                <label class="form-title control-label">
                                                    <span class="text-danger">*</span><b>密码</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="password" maxlength="300" class="form-control"
                                                           name="password">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="re-password">
                                            <div class="form-group find-name">
                                                <label class="form-title control-label">
                                                    <span class="text-danger">*</span><b>确认密码</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="password" maxlength="300" class="form-control"
                                                           name="re-password">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="address">
                                            <div class="form-group find-name" >
                                                <label class="form-title control-label">
                                                    <span class="text-danger"></span><b>家庭地址</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="text" maxlength="300" class="form-control"
                                                           name="address">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="workAddress">
                                            <div class="form-group find-name" >
                                                <label class="form-title control-label">
                                                    <span class="text-danger"></span><b>工作地址</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="text" maxlength="300" class="form-control"
                                                           name="workAddress">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="telephone">
                                            <div class="form-group find-name" >
                                                <label class="form-title control-label">
                                                    <span class="text-danger"></span><b>电话号码</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="text" maxlength="300" class="form-control"
                                                           name="telephone">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12 first" id="contacts">
                                            <div class="form-group find-name" >
                                                <label class="form-title control-label">
                                                    <span class="text-danger"></span><b>紧急联系人</b>
                                                </label>
                                                <div class="form-content">
                                                    <input type="text" maxlength="300" class="form-control"
                                                           name="contacts">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-8 col-md-8 col-sm-8">
                                            <div class="form-group">
                                                <label class="form-title control-label"><b>身份证照片</b></label>
                                                <div class="form-content">
                                                    <div class="col-sm-9 p-l-0">
                                                        <input type="file" multiple id="idCard" class="form-control">
                                                    </div>
                                                    <div class="col-sm-3">
                                                <span>
                                                    <button class="btn-info" type="button"
                                                            onclick="submitPicture('idCard')">上传</button>
                                                </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <p class="form-control-static"></p>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="form-title control-label">&nbsp;</label>
                                        <div class="form-content" style="padding-left: 0px;">
                                            <div id="addFile-idCard"></div>
                                        </div>
                                    </div>

                                    <div class="text-center">
                                        <button class="btn btn-success" type="button" onclick="saveForm()">保存</button>
                                        <button class="btn btn-default" type="button"
                                                onclick="javascript:history.back().reload()">返回
                                        </button>
                                    </div>
                                    <br />
                                </div>
                            </div>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>

    <script th:inline="javascript">

        function saveForm() {
            var username = $("input[name='username']").val();
            var password = $("input[name='password']").val();
            var re_pass = $("input[name='re-password']").val();

            if ($.trim(username) == '') {
                return;
            }
            if ($.trim(password) == '') {
                return;
            }
            if(password != re_pass) {
                alert("两次密码不一样");
                return;
            }

            $.ajax({
                url: '/travel/saveVol',
                data: $("#form-submit").serialize(),
                type: 'post',
                dataType: 'json',
                success: function (result) {
                    if (result.code == 200) {
                        window.location.href = "/travel";
                    } else {
                        alert(result.message);
                    }
                }
            })
        }

        function submitPicture(field) {
            var target = $("#" + field).val();
            if (target == '') {
                layer.alert("请选择要上传的附件！");
                return;
            }
            ;
            var data = new FormData();
            var files = document.getElementById(field).files;
            for (var i = 0; i < files.length; i++) {
                data.append("files", files[i]);
            }
            $.ajax({
                url: '/travel/savePic',
                data: data,
                type: 'post',
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                dataType: 'json',
                success: function (result) {
                    console.log(result);
                    var data = result.data;
                    var fileHtml = [];
                    fileHtml.push('&nbsp;<button type="button" class="btn btn-warning btn-sm waves-effect waves-light margin-label">');
                    fileHtml.push('<input type="hidden" name="' + field + '" value="' + data.id + '">');
                    fileHtml.push('' + data.originalName + '<b onclick="deleteFile(this)">×</b>');
                    fileHtml.push('</button>&nbsp;');
                    $("#addFile-" + field).html(fileHtml.join(''));
                }
            })
        }

        function deleteFile(_this) {
            var id = $(_this).siblings("input").val();
            $.ajax({
                url: '/travel/delPic',
                data: {'fileId': id},
                type: 'post',
                dataType: 'json',
                success: function (result) {
                    if (result.code == 200) {
                        $(_this).parent().remove();
                    }
                }
            })
        }


    </script>
</div>
</html>
